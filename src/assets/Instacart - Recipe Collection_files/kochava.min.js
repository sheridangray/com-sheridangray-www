!function(){var e,t=new r,o="identity-resolver.api.kochava.com";if("undefined"!=typeof window){var n=window.kochava;window.kochava=t}function r(){e=this}r.prototype.init=function(t,o,n,i=!1){if(e.startTime=t,e.appID=o,e.page_name=s(),e.useCookie=i||!1,e.verbose=n||!1,e.sid=x().substr(0,5),e.ck_keys=["kochava_device_id","kochava_app_id","nt_id","sdk_version","action"],e.watch_keys=["device_ids.kochava_device_id","device_id.kochava_device_id",".kochava_device_id",".kochava_app_id",".nt_id","data.disp_w","data.disp_h","data.language",".sdk_version",".action",".data",".device_id","data.device_ids","data.device_orientation"],e.ignore_keys=["data.user_agent","event_data.page_name"],"undefined"!=typeof console&&void 0!==console.log?e.logging=!0:e.logging=!1,null!=o&&""!=o){e.utm=f("ko_click_id",o+"_click",e.useCookie);var r=f("kv_id","kv_id",e.useCookie);e.kvID=""==r?T(e.useCookie):r,""==r&&e.install()}},r.prototype.identify=function(t,o){var n;if(""!=(n="string"==typeof t?JSON.stringify({custom_id:t}):JSON.stringify(t)||"")?(e.customTraits=n,y("c_trt",e.customTraits,e.useCookie)):e.customTraits=f("c_trt","c_trt",e.useCookie),""!=e.customTraits)try{var i={method:"POST",endpoint:"web-sdk.control.kochava.com/v1/cpi/identityLink.php",body:e.getIdentityPayload(e.customTraits),contentType:"application/json",retries:10,async:!0};e.verbose&&e.logging&&console.log("kochava.identify request: ",i),c(i,o)}catch(t){e.verbose&&e.logging&&console.log("kochava.identify error: ",t.message)}},r.prototype.submitCookieId=function(t,n,i,r,a,s){try{var d={method:"POST",endpoint:o+"/cookie/submit",body:{partner_cookie_id:t},contentType:"application/json",retries:10,async:a,appGuid:n,authCode:r,nonce:i,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.submitCookieId request: ",d),c(d,s)}catch(t){e.verbose&&e.logging&&console.log("kochava.submitCookieId error: ",t.message)}},r.prototype.getCookieId=function(t,n,i){try{var r={method:"GET",endpoint:o+"/cookie/retrieve",contentType:"application/json",retries:10,async:n,appGuid:t,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.getCookieId request: ",r),c(r,i)}catch(t){e.verbose&&e.logging&&console.log("kochava.getCookieId error: ",t.message)}},r.prototype.getMAID=function(t,n,i,r,a){try{var s={method:"GET",endpoint:o+"/maid/get",contentType:"application/json",retries:10,async:r,appGuid:t,authCode:i,nonce:n,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.getMAID request: ",s),c(s,a)}catch(t){e.verbose&&e.logging&&console.log("kochava.getMAID error: ",t.message)}},r.prototype.activity=function(t,o,n){t=t||"";try{var i={method:"POST",endpoint:"web-sdk.control.kochava.com/track/json",body:e.getPayload(t,o),contentType:"application/json",retries:10,async:!0};e.verbose&&e.logging&&console.log("kochava request: ",i),c(i,n)}catch(t){e.verbose&&e.logging&&console.log("kochava error: ",t.message)}},r.prototype.page=function(t,o,n){e.page_name=t||e.page_name,e.activity("page",o,n)},r.prototype.conversion=function(t,o,n){t=t||"",e.activity("conversion_"+t,o,n)},r.prototype.install=function(t){e.activity("install",null,t)},r.prototype.getKochavaId=function(){return e.kvID},r.prototype.getPayload=function(t,o){o=o||{};var n={kochava_app_id:e.appID,kochava_device_id:e.kvID,sdk_version:"WebSDK 1.1.4",nt_id:e.sid+"-"+x(),data:{language:u(),device_orientation:g(),user_agent:d(),device_ids:{kochava_device_id:e.kvID}}},i=l(),r=p();if(null!=i&&(n.data.disp_w=i),null!=r&&(n.data.disp_h=r),"string"==typeof e.utm&&""!=e.utm&&(n.data.conversion_data={},n.data.conversion_data.utm_source=e.utm),"install"==t)n.action="install";else{if(n.action="event",n.data.event_name=t,n.data.event_data={page_name:e.page_name},"page"!=t){var a=(new Date).getTime()-e.startTime;n.data.event_data.time_on_page=Math.round(a/1e3)}if("object"==typeof o)for(key in o)o.hasOwnProperty(key)&&(n.data.event_data[key]=o[key]);else null!=o&&e.verbose&&e.logging&&console.log("Unexpected type of options_array")}return n},r.prototype.getIdentityPayload=function(t){var o={kochava_app_id:e.appID,nt_id:e.sid+"-"+x(),device_id:{kochava_device_id:e.kvID}};if(""!=t)try{o.data=JSON.parse(t)}catch(t){e.verbose&&e.logging&&console.log("Error parsing custom_trait JSON: ")}return o};var a,c=function(t,o){var n=t.method||"GET",i=t.endpoint,r=t.body||{},a=t.contentType||"application/json",s=t.retries,d=t.async||!1,u=t.withCredentials||!1;i="undefined"==typeof document||t.secure?"https://"+i:("https:"===document.location.protocol?"https://":"http://")+i;var l=String.fromCharCode(110,116,95,105,100);r.hasOwnProperty(l)&&"string"==typeof r[l]&&(r[l]+=v(r)),r="application/json"===a?JSON.stringify(r):r,"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")});try{var p=new XMLHttpRequest;u&&(p.withCredentials=!0)}catch(t){return e.verbose&&e.logging&&console.log("Error completing request: ",t),void("function"==typeof o&&o(!0,null))}p.open(n,i,d),a&&p.setRequestHeader("Content-Type",a),t.authCode&&t.nonce&&t.appGuid?p.setRequestHeader("Authorization",t.appGuid+", "+t.nonce+", "+t.authCode):t.appGuid&&p.setRequestHeader("Authorization",t.appGuid),p.onerror=function(){if(--s>0){e.verbose&&e.logging&&console.log("Error: API call failed at the network level. Attempt:"+(10-s));var n=10-s;t.retries=s;var i=n*n*500;i>6e4&&(i=6e4),setTimeout(function(){c(t,o)},i)}else e.verbose&&e.logging&&console.log("Error: API call failed at the network level (retry limit hit)."),"function"==typeof o&&o(!0,null)},p.onload=function(n){if(200!=p.status&&204!=p.status){if(401==p.status&&(e.verbose&&e.logging&&console.log("unauthorzied request"),"function"==typeof o))return void o(!0,p.status);try{var i=(n=JSON.parse(p.responseText)).error,r=n.error_description}catch(e){}if(--s>0){e.verbose&&e.logging&&console.log("Error ("+p.status+")("+i+"): "+r);var a=10-s;t.retries=s;var d=a*a*500;d>6e4&&(d=6e4),setTimeout(function(){c(t,o)},d)}else e.verbose&&e.logging&&console.log("Error (retry limit hit) ("+p.status+")("+i+"): "+r),"function"==typeof o&&o(!0,n)}else if(e.verbose&&e.logging&&console.log("event sent successfully"),"function"==typeof o){try{n=JSON.parse(p.responseText)}catch(e){n=p.responseText}o(!1,n)}},p.send(r)},s=function(){var e="";return"undefined"!=typeof location&&(e=(e=location.pathname.substring(1)).replace(/\/+$/,"")),""==e?"/":e},d=function(){return"undefined"!=typeof navigator?navigator.userAgent:""},u=function(){return"undefined"!=typeof navigator?navigator.language:""},l=function(){return"undefined"!=typeof window?window.screen.availWidth:null},p=function(){return"undefined"!=typeof window?window.screen.availHeight:null},g=function(){return"undefined"!=typeof window?window.innerWidth<window.innerHeight?"portrait":"landscape":""},v=function(e){var t=C("",e,2,0),o=t[1];if("string"!=typeof o&&!(o instanceof String))return"-fdx000";for(val=0,i=0;i<o.length;i++){var n=o.codePointAt(i);if(n>127)break;val=(val+n)%1e3}return"-fdx"+t[0]+t[2]+val},f=function(e,t,o){var n=b(e);if(""==n?n=h(t):y(t,n,o),o){if(""!=n)return k(t,n),n;""!=(n=m(t))&&y(t,n,o)}return null===n?"":n},y=function(e,t,o){_(e,t),o&&k(e,t)},h=function(e){if("undefined"==typeof localStorage)return"";var t;try{t=localStorage.getItem(e)}catch(e){return""}return null===t?"":t},_=function(e,t){if("undefined"==typeof localStorage)return!1;try{localStorage.setItem(e,t)}catch(e){return!1}return!0},k=function(e,t){var o,n=new Date;n.setTime(n.getTime()+31536e7),o="; expires="+n.toUTCString(),document.cookie=e+"="+(t||"")+o+"; path=/;domain="+w()},m=function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""},w=function(){try{return window.location.host.match(/[^\.]*\.[^.]*$/)[0]}catch(e){return window.location.host}},b=function(e){if("undefined"==typeof location||void 0===location.search)return"";e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},T=function(e){var t="KW"+Math.round(+new Date/1e3)+"T"+x();return y("kv_id",t,e),t},x=function(){var e=(new Date).getTime();return"xxxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:3&o|8).toString(16)})},C=function(t,o,n,i){var r=[0,"",n];for(var a in o)"string"!=typeof a?r[0]|=2:o.hasOwnProperty(a)&&!e.ignore_keys.includes(t+"."+a)&&("object"==typeof o[a]?i<n&&(ret=C(a,o[a],n,i+1),r[0]|=ret[0],r[1]+=ret[1]):"array"!=typeof o[a]&&("string"==typeof o[a]&&e.ck_keys.includes(a)&&(r[1]+=a+o[a]),null==(a+o[a].toString()).match(/^([a-zA-Z0-9 ._-]+)$/,"")&&(r[0]|=e.watch_keys.includes(t+"."+a)?2:1)));return r};if("undefined"!=typeof exports&&(exports.Kochava=r),n)for(;args=n.shift();){var I=args.shift();(a=t[I])&&a.constructor&&a.call&&a.apply&&t[I].apply(this,args)}}();