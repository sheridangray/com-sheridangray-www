"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[345],{99693:(t,e,r)=>{r.r(e),r.d(e,{FORTESTONLYLatencyMetrics:()=>E,default:()=>j,registerPerformanceObserverLongTask:()=>T});var n=r(3946),i=r(49214),o=r(96412),a=r(1956),c=r(911);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=d(t);if(e){var i=d(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}function f(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return p(t)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}let m=function(t){u(r,t);var e=l(r);function r(...t){var n;return s(this,r),(n=e.call(this,...t)).toTraceId=()=>"",n.toSpanId=()=>"",n}return r}(c.SpanContext),y=function(t){u(r,t);var e=l(r);function r(...t){var n;return s(this,r),(n=e.call(this,...t)).context=()=>new m,n}return r}(c.Span);const v=new(function(t){u(r,t);var e=l(r);function r(...t){var n;return s(this,r),(n=e.call(this,...t)).startSpan=()=>new y,n.init=()=>p(n),n.setUrl=()=>p(n),n.use=()=>p(n),n.scope=()=>({}),n.trace=()=>{},n.wrap=()=>{},n.getRumData=()=>"",n}return r}(c.Tracer));var w=r(99021);function b(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const g="undefined"!=typeof window?window.performance:void 0,k=["/:retailerSlug/browse_departments","/browse"],S="/:retailerSlug/collections/:collectionSlug",P="".concat(S,"/subjects/:subjectId?"),O="/:retailerSlug/departments/:id",R="".concat(O,"/aisles/:id"),_=async(t,e,n)=>{const i=r.e(133).then(r.bind(r,26781)).then((t=>t.default.waitForAppInitialized())),o=Promise.all([r.e(364),r.e(304)]).then(r.bind(r,53479)).then((t=>t.default)),[a]=await Promise.all([o,i]),c="".concat(t,":").concat(e);a.track(c,n)};let E=function(){function t(){var e,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.traceReactProfilerRender=(t,e,r,n,i,o,a)=>{const{pageSpan:c}=this,s=null==g?void 0:g.timing.navigationStart;if(!s)return;if(!c)return;const u=s+i,h=s+o,l=h-u;v.startSpan("react-render",{childOf:c,startTime:u,tags:{duration:l,id:t,phase:e,"resource.name":t}}).finish(h)},this.tracePerformanceObserverLongTask=t=>{try{const{pageSpan:e,pathChangedAt:r}=this;if(!(null==g?void 0:g.timing.navigationStart))return;if(!e)return;const{duration:n,startTime:i,name:o}=t,a=r+i,c=a+n;v.startSpan("long-task",{childOf:e,startTime:a,tags:{duration:n,"resource.name":o}}).finish(c)}catch(t){a.Z.warn(t)}},this.initTime=(new Date).getTime(),this.isDebug=("undefined"!=typeof window&&(null===(e=window)||void 0===e||null===(r=e.location)||void 0===r?void 0:r.search)||"").indexOf("latency_debug=")>=0;const n=(null==g?void 0:g.timing)||{navigationStart:this.initTime};this.mode="path",this.pathChangedAt=n.navigationStart,this.isDebug&&a.Z.debug("ðŸ“ init, time: ".concat(this.pathChangedAt),{owner:a.Z.defaultOwner()}),this.pathChanged=!1,this.isMobile=function(){try{return(0,w.y0)().deviceInfo.isMobile}catch(t){return"undefined"==typeof window||a.Z.error("Unable to retrieve isMobile flag",{error:t,owner:"customers_platform"}),!1}}(),this.eventsRecorded={},this.scrollY=0,this.viewId=(0,i.Z)(),this.setSurface(o.Z.location),o.Z.listen(((t,e)=>{"REPLACE"!==e?(this.pathReset(),this.setSurface(t)):this.setSurface(t)}))}var e,r,c;return e=t,(r=[{key:"track",value:function(t,e,r){return this.trackWith(_,t,e,r)}},{key:"trackPrimary",value:function(t,e,r){return this.trackPrimaryWith(_,t,e,r)}},{key:"trackWith",value:function(t,e,r,n){return this.doTrack(t,e,r,{trackingProperties:n,primary:!1})}},{key:"trackPrimaryWith",value:function(t,e,r,n){return this.doTrack(t,e,r,{trackingProperties:n,primary:!0})}},{key:"setMode",value:function(t={mode:"interaction"}){if(this.baseReset(),"interaction"===(e=t).mode||"omit"===e.mode){const{mode:e}=t;this.mode=e,this.interactionStartAt=(new Date).getTime(),this.isDebug&&a.Z.debug("ðŸ“ mode: interaction, time: ".concat(this.interactionStartAt),{owner:a.Z.defaultOwner()})}else if((t=>"overlay"===t.mode)(t)){const{mode:e,overlaySurface:r}=t;this.mode=e,this.interactionStartAt=(new Date).getTime(),this.overlaySurface=r,this.isDebug&&a.Z.debug("ðŸ“ mode: overlay, time: ".concat(this.interactionStartAt,", overlaySurface: ").concat(r),{owner:a.Z.defaultOwner()})}else this.interactionStartAt=void 0,this.isDebug&&a.Z.debug("ðŸ“ mode: omit",{owner:a.Z.defaultOwner()});var e}},{key:"doTrack",value:function(t,e,r,n){const{trackingProperties:i}=n;if(!this.surface)return;if("omit"===this.mode)return;let o=this.eventsRecorded[r]||0;if(o+=1,this.eventsRecorded[r]=o,![1,2,4,8,16].includes(o))return;const c="number"==typeof(null==i?void 0:i.eventTime)&&i.eventTime||(new Date).getTime();let s=this.pathChangedAt,u=this.pathChanged,h="".concat(this.surface);if("interaction"===this.mode||"overlay"===this.mode){if(!this.interactionStartAt)return;s=this.interactionStartAt,u=!0,"overlay"===this.mode&&(h="".concat(this.overlaySurface))}const l={...i,time:c-s,number:o,mode:this.mode,viewId:this.viewId,surface:h,lastSurface:this.lastSurface,mobile:this.isMobile,scrolled:this.scrollY!==("undefined"!=typeof window&&window.scrollY),spa:u,...!u&&this.coldStartBreakdown()};1===l.number&&this.isDebug&&a.Z.debug("ðŸ“ track: first image latency ".concat(e,".").concat(r," ").concat(l.time,"ms [").concat(JSON.stringify(l),"]"),{owner:a.Z.defaultOwner()}),t(e,r,l)}},{key:"pathReset",value:function(){this.mode="path",this.interactionStartAt=void 0,this.viewId=(0,i.Z)(),this.pathChanged=!0,this.pathChangedAt=(new Date).getTime(),this.baseReset(),this.isDebug&&a.Z.debug("ðŸ“ pathReset, time: ".concat(this.pathChangedAt),{owner:a.Z.defaultOwner()})}},{key:"baseReset",value:function(){this.eventsRecorded={},this.scrollY="undefined"!=typeof window&&window.scrollY||0}},{key:"setSurface",value:function(t){if(this.lastSurface=this.surface,this.surface=void 0,void 0===t)return;const e=t.pathname;(0,n.matchPath)(e,{path:"/:retailerSlug/search(.*?)/:term?"})?this.surface="search":(0,n.matchPath)(e,{path:R})?this.surface="aisle":(0,n.matchPath)(e,{path:O})?this.surface="department":(0,n.matchPath)(e,{path:k})?this.surface="explore":(0,n.matchPath)(e,{path:"/:retailer_slug/buy_it_again"})?this.surface="your_items":(0,n.matchPath)(e,{path:"/:retailerSlug/storefront"})?this.surface="storefront":(0,n.matchPath)(e,{path:"/",exact:!0})||(0,n.matchPath)(e,{path:"/__home_v4__",exact:!0})?this.surface="home":(0,n.matchPath)(e,{path:P})?this.surface="subjects":(0,n.matchPath)(e,{path:S})?this.surface="collections":(0,n.matchPath)(e,{path:"/hub/:hub_name/:child_collection_slug?"})?this.surface="collections_hub":(0,n.matchPath)(e,{path:"/checkout_v3"})?this.surface="checkout":(0,n.matchPath)(e,{path:"/order_placed/:order_id"})?this.surface="post_checkout_flow":(0,n.matchPath)(e,{path:"/items/:item_id"})?this.surface="item_details":(0,n.matchPath)(e,{path:"/orders/:order_id"})?this.surface="order_status":(0,n.matchPath)(e,{path:"/:retailerSlug/recipes",exact:!0})?this.surface="recipe_tab":(0,n.matchPath)(e,{path:"/:retailerSlug/recipes/:recipe_id"})?this.surface="recipe_detail":(0,n.matchPath)(e,{path:"/recipes/:recipe_id"})&&(this.surface="agnostic_recipe_detail"),this.isDebug&&a.Z.debug("ðŸ“ setSurface: ".concat(this.surface),{owner:a.Z.defaultOwner()})}},{key:"coldStartBreakdown",value:function(){const t="undefined"!=typeof window&&window.performance&&window.performance.timing;if(!t||!t.navigationStart)return{coldStartTimingClientSupport:!1};const{navigationStart:e,fetchStart:r,domainLookupStart:n,connectStart:i,responseStart:o,requestStart:a,responseEnd:c}=t;return{coldStartTimingClientSupport:!0,coldStartRedirectOverhead:r-e,coldStartAppCacheOverhead:n-r,coldStartDnsOverhead:i-n,coldStartTcpOverhead:a-i,coldStartRequestOverhead:o-a,coldStartResponseOverhead:c-o,coldStartNetworkOverhead:c-r,coldStartPreInitOverhead:this.initTime-e}}}])&&b(e.prototype,r),c&&b(e,c),t}();function T(t){try{new PerformanceObserver((function(e){e.getEntries().forEach((e=>{t(e)}))})).observe({entryTypes:["longtask"]})}catch(t){a.Z.warn(t)}}const j=new E},71074:(t,e,r)=>{r.d(e,{Z:()=>w});var n=r(67598),i=r(51494),o=r(1956),a=r(1993),c=r.n(a),s=r(26511);function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p(t);if(e){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}function f(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}let d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(o,t);var e,r,n,i=l(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,(t=>r.onSubscribe(t)))).status=s.q.Ready,r.observers=new Set,r.engine=t,r.itemId=e,r}return e=o,(r=[{key:"refetch",value:function(){0!==this.observers.size&&(this.itemId.length<1?this.markError(new Error("Invalid itemId with zero length while fetching price")):(this.status=s.q.InFlight,this.engine.fetchPriceResponse(this.itemId).then((t=>{this.markResult(t)})).catch((t=>{this.markError(t)}))))}},{key:"checkTTL",value:function(){this.status!==s.q.InFlight&&this.engine.getExpiresAtEpoch(this.itemId)<=Date.now()&&this.refetch()}},{key:"onSubscribe",value:function(t){const e=0===this.observers.size;return this.observers.add(t),this.lastError?t.error&&t.error(this.lastError):this.lastResult&&t.next&&t.next(this.lastResult),e&&this.refetch(),this.checkTTL(),()=>{this.observers.delete(t)}}},{key:"markResult",value:function(t){this.lastResult=t,this.lastError=void 0,this.status=s.q.Ready,this.observers.forEach((e=>e.next&&e.next(t)))}},{key:"markError",value:function(t){this.lastError=t,this.status=s.q.Error,this.observers.forEach((e=>e.error&&e.error(t)))}}])&&u(e.prototype,r),n&&u(e,n),o}(c());var m=r(65484);function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const v="PriceEngine:";const w=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.prices=new Map,this.expiresAtEpochs=new Map,this.queue=new Set,this.batchTimeoutMs=0}var e,r,a;return e=t,(r=[{key:"setOptions",value:function(t){this.batchTimeoutMs=t.batchTimeoutMs}},{key:"evict",value:function(t){const e=this.prices.get(t);return!!e&&(e.refetch(),!0)}},{key:"evictAll",value:function(){Array.from(this.prices.values()).forEach((t=>{t.refetch()}))}},{key:"cacheReset",value:function(){this.prices.clear()}},{key:"getPrice",value:function(t){return this.prices.has(t)||this.prices.set(t,new d(this,t)),this.prices.get(t)}},{key:"fetchPriceResponse",value:function(t){return this.fetchPriceResponseArray([t]).then((t=>t[0]))}},{key:"fetchPriceResponseArray",value:function(t){let e,r;const n=new Promise(((t,n)=>{e=t,r=n}));return this.queue.add({itemIds:t,promise:n,resolve:e,reject:r}),this.startBatchTimer(),n}},{key:"getExpiresAtEpoch",value:function(t){return this.expiresAtEpochs.get(t)||1/0}},{key:"batchedFetchPriceResponse",value:function(t){return(0,n.Z)("/v3/view/item_attributes/".concat(t.join(","))).then((e=>{const r=null==e?void 0:e.view;if(r){const e=6e5,n=Date.now()+e;return t.reduce(((t,e)=>t.set(e,n)),this.expiresAtEpochs),r}throw new Error("Unexpected price response")}))}},{key:"chunkBatches",value:function(){const t=this.consumeQueue(),e=[];for(let r=0,n=t.length-1;r<=n;r+=100)e.push(t.slice(r,r+100));e.forEach((t=>this.handleBatch(t)))}},{key:"handleBatch",value:function(t){const e=function(t){return[...new Set(t)].sort()}(t.reduce(((t,e)=>t.concat(e.itemIds)),[]));(0,i.Z)((()=>this.batchedFetchPriceResponse(e)),{jitter:i.r.Full}).then((e=>{const r=new Map;e.forEach((t=>{const{itemId:e}=t;r.set(e,t)})),t.forEach((t=>{const e=[];t.itemIds.every((n=>{const i=r.get(n);return i?(e.push(i),!0):(o.Z.error("".concat(v," missing price for itemId ").concat(n),{owner:"customers_platform"}),t.reject(new m.I(n)),!1)}))&&t.resolve(e)}))})).catch((e=>{o.Z.error(e,{owner:"customers_platform",message:"".concat(v," price batch error ").concat(e.message)}),t.forEach((t=>{t.reject(e)}))}))}},{key:"consumeQueue",value:function(){const t=Array.from(this.queue.values());return this.queue.clear(),t}},{key:"startBatchTimer",value:function(){void 0===this.batchTimeout&&(this.batchTimeout=setTimeout((()=>{delete this.batchTimeout,this.chunkBatches()}),this.batchTimeoutMs))}}])&&y(e.prototype,r),a&&y(e,a),t}())},65484:(t,e,r)=>{function n(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return i(t)}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(t){var e="function"==typeof Map?new Map:void 0;return o=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return a(t,arguments,u(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s(n,t)},o(t)}function a(t,e,r){return a=c()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&s(i,r.prototype),i},a.apply(null,arguments)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}r.d(e,{I:()=>h});let h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(MissingPriceError,t);var e,r,o=(e=MissingPriceError,r=c(),function(){var t,i=u(e);if(r){var o=u(this).constructor;t=Reflect.construct(i,arguments,o)}else t=i.apply(this,arguments);return n(this,t)});function MissingPriceError(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,MissingPriceError),(e=o.call(this)).toReadableString=()=>{const{name:t,itemId:r}=i(e);return"".concat(t,": server did not return price for ").concat(r)},e.name="MissingPriceError",e.itemId=t,e.message=e.toReadableString(),e}return MissingPriceError}(o(Error))},26511:(t,e,r)=>{let n;r.d(e,{q:()=>n}),function(t){t[t.Ready=0]="Ready",t[t.InFlight=1]="InFlight",t[t.Error=2]="Error"}(n||(n={}))},51494:(t,e,r)=>{let n;r.d(e,{r:()=>n,Z:()=>c}),function(t){t.None="none",t.Full="full"}(n||(n={}));const i={delayFirstAttempt:!1,jitter:n.None,retry:t=>"rejected"===t.promiseState,numOfAttempts:10,timeMultiple:2,startingDelay:100,maxDelay:1e3};function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}let a=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.attempts=0,this.work=e,this.options=r}var e,r,n;return e=t,(r=[{key:"execute",value:function(){return this.try()}},{key:"try",value:function(){let t;return t=0===this.attempts?this.work():this.delay().then((()=>this.work())),t.then((t=>this.shouldRetry({value:t,promiseState:"resolved"})?this.try():t)).catch((t=>{if(this.shouldRetry({value:t,promiseState:"rejected"}))return this.try();throw t}))}},{key:"shouldRetry",value:function(t){return this.attempts=this.attempts+1,!!(this.attempts<this.options.numOfAttempts&&this.options.retry(t,this.attempts))}},{key:"delay",value:function(){return this.attempts>0?new Promise((t=>{setTimeout((()=>t()),this.delayTime)})):Promise.resolve()}},{key:"delayTime",get:function(){const t=Math.min(this.options.maxDelay,this.options.startingDelay*this.options.timeMultiple**(this.attempts-1));return"full"===this.options.jitter?(e=1,r=t,Math.floor(Math.random()*(r-e)+e)):t;var e,r}}])&&o(e.prototype,r),n&&o(e,n),t}();function c(t,e){const r=function(t){const e={...i,...t};return e.numOfAttempts<1&&(e.numOfAttempts=1),e}(e);return new a(t,r).execute()}}}]);